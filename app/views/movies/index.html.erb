<main class="min-h-screen bg-neutral-25 px-6 py-12">
  <section class="mx-auto max-w-5xl space-y-10 rounded-3xl border border-neutral-100 bg-white/90 p-8 shadow-card backdrop-blur">
    <header class="space-y-3 text-center">
      <p class="badge mx-auto bg-brand-50 text-brand-700 ring-brand-100">Movie Search</p>
      <h1 class="font-display text-3xl font-semibold text-slate-900">Find a movie by title</h1>
      <p class="text-slate-600">Search TMDB for movies and view quick details.</p>
    </header>

    <%= form_with url: movies_path, method: :get, local: true, class: "flex flex-col gap-4 sm:flex-row" do |form| %>
      <div class="flex-1">
        <label for="query" class="sr-only">Search for a movie</label>
        <%= form.text_field :query,
          value: @query,
          id: "query",
          placeholder: "Enter a movie title...",
          class: "w-full rounded-xl border border-neutral-200 bg-white px-4 py-3 text-base text-slate-800 shadow-sm transition focus:border-brand-400 focus:outline-none focus:ring-2 focus:ring-brand-200"
        %>
      </div>
      <%= form.submit "Search", class: "inline-flex items-center justify-center rounded-xl bg-brand-600 px-6 py-3 font-semibold text-white shadow-sm transition hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-brand-200" %>
    <% end %>

    <% if flash[:alert].present? %>
      <div class="rounded-xl border border-amber-200 bg-amber-50 px-4 py-3 text-left text-amber-800"> <%= flash[:alert] %> </div>
    <% end %>

    <% if @query.present? %>
      <% if @results.any? %>
        <div class="space-y-4">
          <p class="text-sm font-semibold text-slate-600">Top results for "<%= @query %>":</p>
          <div class="grid gap-6 md:grid-cols-2">
            <% @results.each do |movie| %>
              <%= turbo_frame_tag "movie-#{movie["id"]}" do %>
                <article class="flex gap-4 rounded-2xl border border-neutral-100 bg-white p-4 shadow-sm transition hover:-translate-y-0.5 hover:shadow-md">
                  <%= image_tag poster_url(movie["poster_path"], size: "w185"), alt: movie["title"], class: "h-36 w-24 rounded-xl object-cover" %>
                  <div class="flex flex-1 flex-col justify-between">
                    <div class="space-y-1">
                      <h2 class="text-lg font-semibold text-slate-900"><%= movie["title"] %></h2>
                      <p class="text-sm text-slate-600">Released: <%= release_year(movie) %></p>
                      <p class="text-sm text-slate-700 line-clamp-2"><%= movie["overview"].presence || "No overview available." %></p>
                    </div>
                    <div class="text-right">
                      <div class="flex items-center justify-end gap-3">
                        <%= link_to "View details", movie_path(movie["id"]), class: "text-brand-600 font-semibold hover:text-brand-700" %>
                        <% if logged_in? %>
                          <% local_movie = Movie.find_by(tmdb_id: movie["id"]) %>
                          <%= render partial: "watchlists/button", locals: { movie_hash: movie, local_movie: local_movie, wl: (local_movie && current_user.watchlists.find_by(movie: local_movie)) } %>
                        <% end %>
                      </div>
                    </div>
                  </div>
                </article>
              <% end %>
            <% end %>
          </div>
        </div>
      <% else %>
        <p class="rounded-xl border border-neutral-200 bg-neutral-50 px-4 py-3 text-slate-700">No results found for "<%= @query %>".</p>
      <% end %>
    <% elsif params.key?(:query) && flash[:alert].blank? %>
      <p class="rounded-xl border border-neutral-200 bg-neutral-50 px-4 py-3 text-slate-700">Please enter a movie title to search.</p>
    <% end %>
  </section>
</main>
