<div class="container mx-auto px-4 py-8">
  <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
    <h1 class="text-4xl font-bold">Welcome, <%= @user.first_name || @user.username %>!</h1>
    <div class="flex gap-3">
      <%= link_to "View Profile", profile_path, class: "bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md shadow" %>
      <%= button_to "Sign Out", logout_path, method: :delete, class: "bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md" %>
    </div>
  </div>
  <section class="mt-8">
    <h2 class="text-2xl font-semibold">My Library</h2>
    <% watchlists = @user.watchlists.includes(:movie) %>
    <% if watchlists.any? %>
      <%= turbo_frame_tag "library-list" do %>
        <div class="mt-4 grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
          <% watchlists.each do |wl| %>
            <%= turbo_frame_tag "watchlist-item-#{wl.id}" do %>
              <% m = wl.movie %>
              <div class="rounded-lg border border-neutral-200 bg-white shadow-sm overflow-hidden hover:shadow-md transition-shadow">
                <!-- Movie Poster -->
                <div class="relative">
                  <%= image_tag m.poster_url.presence || "https://placehold.co/150x225?text=No+Image", alt: m.title, class: "w-full h-40 object-cover" %>
                  <div class="absolute top-2 right-2">
                    <%= button_to "Remove", watchlist_path(wl), method: :delete, data: { turbo_frame: "watchlist-item-#{wl.id}" }, class: "inline-flex items-center rounded-md bg-red-600 hover:bg-red-700 px-2 py-1 text-xs text-white font-medium" %>
                  </div>
                </div>

                <!-- Movie Info -->
                <div class="p-3 space-y-2">
                  <h3 class="font-semibold text-sm line-clamp-2 text-slate-900"><%= m.title %></h3>
                  <p class="text-xs text-slate-600">Status: <%= wl.status.humanize %></p>

                  <!-- Star Rating -->
                  <div class="pt-1">
                    <%= render "ratings/star_rating", movie: m, show_form: false %>
                  </div>

                  <!-- Tags -->
                  <% if m.tags.any? %>
                    <div class="flex flex-wrap gap-1 pt-2">
                      <% m.tags.each do |tag| %>
                        <span class="inline-flex items-center rounded-full bg-gray-200 px-2 py-0.5 text-xs font-medium text-gray-800" style="background-color: rgb(229, 231, 235); color: rgb(31, 41, 55); border-radius: 9999px; padding: 2px 8px; display: inline-flex; align-items: center;">
                          <%= tag.name %>
                        </span>
                      <% end %>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <p class="mt-2 text-slate-600">Your library is empty. Add movies from the search results.</p>
    <% end %>
  </section>
</div>
